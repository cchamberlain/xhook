// XHook - v1.4.9 - https://github.com/jpillora/xhook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2020
(function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};r=null,r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:"undefined"!=typeof global?global:a,y=r.document,d="before",c="after",p="readyState",o="addEventListener",n="removeEventListener",i="dispatchEvent",v="XMLHttpRequest",h="fetch",j="FormData",q=["load","loadend","loadstart"],f=["progress","abort","error","timeout"],e=[101,204,205,304],F="undefined"!=typeof navigator&&navigator.useragent?navigator.userAgent:"",B=parseInt((/msie (\d+)/.exec(F.toLowerCase())||[])[1]),isNaN(B)&&(B=parseInt((/trident\/.*; rv:(\d+)/.exec(F.toLowerCase())||[])[1])),(H=Array.prototype).indexOf||(H.indexOf=function(a){var b,c,d;for(b=c=0,d=this.length;c<d;b=++c)if(this[b]===a)return b;return-1}),E=function(a,b){return Array.prototype.slice.call(a,b)},x=function(a){return"returnValue"===a||"totalSize"===a||"position"===a},A=function(a,b){var c;for(c in a)if(a[c],!x(c))try{b[c]=a[c]}catch(a){}return b},C=function(a){return void 0===a?null:a},D=function(a,b,c){var d,e,f,g;for(e=function(a){return function(d){var e,f,g;e={};for(f in d)x(f)||(g=d[f],e[f]=g===b?c:g);return c[i](a,e)}},f=0,g=a.length;f<g;f++)d=a[f],c._has(d)&&(b["on"+d]=e(d))},z=function(a){var b;if(y&&null!=y.createEventObject)return b=y.createEventObject(),b.type=a,b;try{return new Event(a)}catch(b){return{type:a}}},g=function(a){var c,d,e;return d={},e=function(a){return d[a]||[]},c={},c[o]=function(a,c,f){d[a]=e(a),d[a].indexOf(c)>=0||(f=f===b?d[a].length:f,d[a].splice(f,0,c))},c[n]=function(a,c){var f;if(a===b)return void(d={});c===b&&(d[a]=[]),-1!==(f=e(a).indexOf(c))&&e(a).splice(f,1)},c[i]=function(){var b,d,f,g,h,i,j,k;for(b=E(arguments),d=b.shift(),a||(b[0]=A(b[0],z(d))),g=c["on"+d],g&&g.apply(c,b),k=e(d).concat(e("*")),f=i=0,j=k.length;i<j;f=++i)h=k[f],h.apply(c,b)},c._has=function(a){return!(!d[a]&&!c["on"+a])},a&&(c.listeners=function(a){return E(e(a))},c.on=c[o],c.off=c[n],c.fire=c[i],c.once=function(a,b){var d;return d=function(){return c.off(a,d),b.apply(null,arguments)},c.on(a,d)},c.destroy=function(){return d={}}),c},G=g(!0),G.EventEmitter=g,G[d]=function(a,b){if(a.length<1||a.length>2)throw"invalid hook";return G[o](d,a,b)},G[c]=function(a,b){if(a.length<2||a.length>3)throw"invalid hook";return G[o](c,a,b)},G.enable=function(){r[v]=u,"function"==typeof s&&(r[h]=s),l&&(r[j]=t)},G.disable=function(){r[v]=G[v],r[h]=G[h],l&&(r[j]=l)},w=G.headers=function(a,b){var c,d,e,f,g,h,i,j,k;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)g=a[e],f=e.toLowerCase(),d.push(f+":\t"+g);return d.join("\n")+"\n";case"string":for(d=a.split("\n"),i=0,j=d.length;i<j;i++)c=d[i],/([^:]+):\s*(.+)/.test(c)&&(f=null!=(k=RegExp.$1)?k.toLowerCase():void 0,h=RegExp.$2,null==b[f]&&(b[f]=h));return b}},l=r[j],t=function(a){var b;this.fd=a?new l(a):new l,this.form=a,b=[],Object.defineProperty(this,"entries",{get:function(){var c;return c=a?E(a.querySelectorAll("input,select")).filter(function(a){var b;return"checkbox"!==(b=a.type)&&"radio"!==b||a.checked}).map(function(a){return[a.name,"file"===a.type?a.files:a.value]}):[],c.concat(b)}}),this.append=function(a){return function(){var c;return c=E(arguments),b.push(c),a.fd.append.apply(a.fd,c)}}(this)},l&&(G[j]=l,r[j]=t),m=r[v],G[v]=m,u=r[v]=function(){var a,b,e,h,j,k,l,m,n,r,s,u,x,y,z,E,F,H,J,K,L;a=-1,H=new G[v],s={},y=null,l=void 0,z=void 0,u=void 0,r=function(){var b,c,d,e;if(u.status=y||H.status,y===a&&B<10||(u.statusText=H.statusText),y!==a){e=w(H.getAllResponseHeaders());for(b in e)d=e[b],u.headers[b]||(c=b.toLowerCase(),u.headers[c]=d)}},n=function(){if(H.responseType&&"text"!==H.responseType)"document"===H.responseType?(u.xml=H.responseXML,u.data=H.responseXML):u.data=H.response;else{u.text=H.responseText,u.data=H.responseText;try{u.xml=H.responseXML}catch(a){}}"responseURL"in H&&(u.finalUrl=H.responseURL)},F=function(){k.status=u.status,k.statusText=u.statusText},E=function(){"text"in u&&(k.responseText=u.text),"xml"in u&&(k.responseXML=u.xml),"data"in u&&(k.response=u.data),"finalUrl"in u&&(k.responseURL=u.finalUrl)},h=function(a){for(;a>b&&b<4;)k[p]=++b,1===b&&k[i]("loadstart",{}),2===b&&F(),4===b&&(F(),E()),k[i]("readystatechange",{}),4===b&&(!1===s.async?e():setTimeout(e,0))},e=function(){l||k[i]("load",{}),k[i]("loadend",{}),l&&(k[p]=0)},b=0,x=function(a){var b,d;if(4!==a)return void h(a);b=G.listeners(c),(d=function(){var a;return b.length?(a=b.shift(),2===a.length?(a(s,u),d()):3===a.length&&s.async?a(s,u,d):d()):h(4)})()},k=s.xhr=g(),H.onreadystatechange=function(a){try{2===H[p]&&r()}catch(a){}4===H[p]&&(z=!1,r(),n()),x(H[p])},m=function(){l=!0},k[o]("error",m),k[o]("timeout",m),k[o]("abort",m),k[o]("progress",function(){b<3?x(3):k[i]("readystatechange",{})}),("withCredentials"in H||G.addWithCredentials)&&(k.withCredentials=!1),k.status=0,L=f.concat(q);for(J=0,K=L.length;J<K;J++)j=L[J],k["on"+j]=null;return k.open=function(a,c,d,e,f){b=0,l=!1,z=!1,s.headers={},s.headerNames={},s.status=0,u={},u.headers={},s.method=a,s.url=c,s.async=!1!==d,s.user=e,s.pass=f,x(1)},k.send=function(a){var b,c,e,g,h,i,j,l;for(l=["type","timeout","withCredentials"],i=0,j=l.length;i<j;i++)c=l[i],(e="type"===c?"responseType":c)in k&&(s[c]=k[e]);s.body=a,h=function(){var a,b,d,g,h,i;for(D(f,H,k),k.upload&&D(f.concat(q),H.upload,k.upload),z=!0,H.open(s.method,s.url,s.async,s.user,s.pass),h=["type","timeout","withCredentials"],d=0,g=h.length;d<g;d++)c=h[d],e="type"===c?"responseType":c,c in s&&(H[e]=s[c]);i=s.headers;for(a in i)b=i[a],a&&H.setRequestHeader(a,b);s.body instanceof t&&(s.body=s.body.fd),H.send(s.body)},b=G.listeners(d),(g=function(){var a,c;return b.length?(a=function(a){if("object"==typeof a&&("number"==typeof a.status||"number"==typeof u.status))return A(a,u),I.call(a,"data")<0&&(a.data=a.response||a.text),void x(4);g()},a.head=function(a){return A(a,u),x(2)},a.progress=function(a){return A(a,u),x(3)},c=b.shift(),1===c.length?a(c(s)):2===c.length&&s.async?c(s,a):a()):h()})()},k.abort=function(){y=a,z?H.abort():k[i]("abort",{})},k.setRequestHeader=function(a,b){var c,d;c=null!=a?a.toLowerCase():void 0,d=s.headerNames[c]=s.headerNames[c]||a,s.headers[d]&&(b=s.headers[d]+", "+b),s.headers[d]=b},k.getResponseHeader=function(a){var b;return b=null!=a?a.toLowerCase():void 0,C(u.headers[b])},k.getAllResponseHeaders=function(){return C(w(u.headers))},H.overrideMimeType&&(k.overrideMimeType=function(){return H.overrideMimeType.apply(H,arguments)}),H.upload&&(k.upload=s.upload=g()),k.UNSENT=0,k.OPENED=1,k.HEADERS_RECEIVED=2,k.LOADING=3,k.DONE=4,k.response="",k.responseText="",k.responseXML=null,k.readyState=0,k.statusText="",k},"function"==typeof r[h]&&(k=r[h],G[h]=k,s=r[h]=function(a,b){var f,g,h;return null==b&&(b={headers:{}}),b.url=a,h=null,g=G.listeners(d),f=G.listeners(c),new Promise(function(a,c){var d,i,j,l,m;i=function(){return b.body instanceof t&&(b.body=b.body.fd),b.headers&&(b.headers=new Headers(b.headers)),h||(h=new Request(b.url,b)),A(b,h)},j=function(b){var c;return f.length?(c=f.shift(),2===c.length?(c(i(),b),j(b)):3===c.length?c(i(),b,j):j(b)):a(b)},d=function(b){var c,d;if(void 0!==b)return c=e.includes(b.status)?null:b.body||b.text,d=new Response(c,b),a(d),void j(d);l()},l=function(){var a;return g.length?(a=g.shift(),1===a.length?d(a(b)):2===a.length?a(i(),d):void 0):void m()},m=function(){return k(i()).then(function(a){return j(a)}).catch(function(a){return j(a),c(a)})},l()})}),u.UNSENT=0,u.OPENED=1,u.HEADERS_RECEIVED=2,u.LOADING=3,u.DONE=4,"function"==typeof define&&define.amd?define("xhook",[],function(){return G}):"object"==typeof module&&module.exports?module.exports={xhook:G}:r&&(r.xhook=G)}).call(this,window);